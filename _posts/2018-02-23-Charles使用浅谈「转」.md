---
layout:     post
title:      Charles使用浅谈「转」
subtitle:   测试工具
date:       2018-01-04
author:     BY
header-img: img/blog/Charles/charles.png
catalog: true
tags:
    - tools
---

> 转 [Charles使用浅谈](http://ishare.58corp.com/index.php/topic/show/1012)


近期团队内部开始总结测试工具，正好利用这次机会把测试中用到的工具都罗列汇总了一次
对于QA来说，最常用的不外乎就是抓包工具了，其中比较好用的就是Fiddler、Charles了，两个各有优点，这次主要为大家介绍Charles的使用


### 目录
- Charles显示模式
- 抓包配置
- 常用基础功能
- 进阶功能

## Charles显示模式
Charles抓包的显示，支持Structure和Sequence两种模式，其优点分别如下
Structure：可以很清晰的看到请求的数据结构，而且是以域名划分请求信息的，可以很清晰的去分析和处理数据
![image](https://raw.githubusercontent.com/lzxiaodong11/lzxiaodong11.github.io/master/img/blog/Charles/20171121145543_93658.png)
Sequence：可以很清晰的看到全部请求，不用一层一层的去点开，这里是以数据请求的顺序去执行的，也就是说那个请求快就在前面显示（和Fiddler类似）
![image](https://raw.githubusercontent.com/lzxiaodong11/lzxiaodong11.github.io/master/img/blog/Charles/20171121145600_91139.png)
## 抓包配置
既然是抓包工具，那么最基本的就是抓包
### 客户端http抓包
1.PC端Charles工具Proxy-->Proxy Settings中设置port为8888
2.手机端在公司wifi中设置手动代理ip为电脑的ip（cmd命令ipconfig快捷查询），端口与PC端一致8888
3.PC端Charles工具弹出弹窗时，选择allow即可
![image](https://raw.githubusercontent.com/lzxiaodong11/lzxiaodong11.github.io/master/img/blog/Charles/20171121151158_74372.png)
以上步骤完成后就可以正常在手机端操作，PC端查看
ps：偶尔出现无法显示抓包数据的情况，重启下手机app或Charles就行
当然以上主要是针对http协议的抓包，由于公司app都已经支持https协议，我们的测试方法也不得不更新换代
（吐槽下：说是因为网络安全，但感觉最大原因是苹果弄了个非https请求可能审核不通过的标准，垄断就是牛X~）
### 客户端https抓包
用正常http抓包的方法在抓https请求就会出现下面这个提示了“SSLHandshake: Received fatal alert: certificate_unknown”，说白了一点就是需要证书才能访问
1.在http抓包配置的基础上
2.PC端Charles工具安装证书Help-->SSL Proxying-->Install Charles Root Certificate（ps：证书存储选择受信的根证书）
![image](https://raw.githubusercontent.com/lzxiaodong11/lzxiaodong11.github.io/master/img/blog/Charles/20171121150951_14004.png)
3.手机端在默认浏览器中输入chls.pro/ssl，按照系统自带的安装方式操作完成安装
4.PC端Charles工具Proxy-->SSL ProxyingSettings-->勾选Enable SSL Proxying，Add配置Host为*，Port为443
![image](https://raw.githubusercontent.com/lzxiaodong11/lzxiaodong11.github.io/master/img/blog/Charles/20171121151024_3129.png)
以上步骤完成后，你就可以发现https请求也可以抓包了
ps：
andr安装证书需开启图案或密码解锁；
andr手机部分浏览器可能不识别证书，可尝试使用qq手机浏览器安装；
ios10以上系统安装完后需要到“设置-通用-关于本机-证书信任设置”中再开启信任一次
若还是无法抓包，检查下防火墙是否关闭；如果你的电脑有小秘密^_^，不想关闭防火墙，可以找一下Charles的安装程序，在防火墙中允许运行
### PC浏览器抓包
针对业务的多元化，PC端或者后台这类业务需求测试时，也可以使用Charles抓包分析
1.Proxy-->Windows proxy  or  Mozilla Firefox proxy直接开启抓取PC浏览器请求
![image](https://raw.githubusercontent.com/lzxiaodong11/lzxiaodong11.github.io/master/img/blog/Charles/20171121151305_23407.png)
2.Proxy->Proxy Settings弹框配置也可以进一步设置
l  Windows：勾选Enable Windows proxy则可以抓取电脑PC浏览器的请求（除火狐）
l  Mozilla Firefox：勾选Enable Mozilla Firefox proxy则可以抓取电脑火狐浏览器的请求
## 常用基础功能
